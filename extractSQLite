# This is for a grasshopper script to read data.
# See loadSQLite  to load the db.
#  https://realpython.com/python-sql-libraries/
#  https://www.sqlitetutorial.net/sqlite-python/creating-tables
#  https://www.geeksforgeeks.org/python/python-convert-string-to-datetime-and-vice-versa/

#  This could all change if the db uses
#     detect_types=sqlite3.PARSE_DECLTYPES | sqlite3.PARSE_COLNAMES
#  which is possibly faster, but let's see.

# Slice is a short window uses for a time period where most sensors will report.
# It might be 12 minutes if sensors report every 10 minutes.
# If more than report for a sensor then the last one will get used.
# A Window may get future use to indicate a period to scroll through.

import sqlite3
from datetime import datetime, timedelta #note both the library and a module call datetime

fmt = '%Y-%m-%d %H:%M:%S'

# grasshopper inputs
# test values
#   dbName = "SenorReadings.sqlite.db"  # grasshopper inputs
#   SliceStart  = datetime.strptime('2025-08-03 18:18:30', fmt)
#   SlicePeriod = timedelta(days=0, hours=0, minutes=0, seconds=5)

SliceEnd = SliceStart + SlicePeriod
#print(SliceEnd)


con = sqlite3.connect(dbName)
#con = sqlite3.connect(dbName, mode="ro")  #CHECK READ ONLY MODE
#con = sqlite3.connect(dbName + '?mode=ro', uri=True)  CHECK READ ONLY MODE this creates new db

st = "(timeStamp > '" +SliceStart.strftime(fmt) + "')"
en = "(timeStamp < '" +   SliceEnd.strftime(fmt) + "')"

z = con.execute("SELECT id, timeStamp, temp FROM sensorData \
                  WHERE " + st + " AND " +  en ).fetchall()

print(z)

#len(z)
#z.pop()
con.close() 
