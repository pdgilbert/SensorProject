#!/usr/bin/env python3

"""
Add a table ...
The table is added  to outdb. If that file does not exist then the db is cretaed.
SQLite db with tables for sensor data and
insert  lines from data file generated by Grasshopper script, see grasshopeNotes.txt

This is only python with SQL. 
See extractSQLite for grasshopper python script to extract data.

Usage:
./loadIDlocationsSQLite  --infile=InputLocationFile  --outdb=OutputDatabaseName 

Example:
./loadIDlocationsSQLite  --infile='sensorLocations.txt'  --outdb='SenorReadings.sqlite.db'  --sensorIdHash='Garage/SensorIdHash.txt'
"""
import argparse
import os
import datetime
import sqlite3

parser = argparse.ArgumentParser(description= 
           'Create and populate SQLite db.')

#parser.add_argument('--dir', type=str, default='./',
#                    help='directory used for all files. (Default: ')

parser.add_argument('--infile', type=str, default='output_v1.csv',
                    help='input data file as produced by SensorDataReformat_v1. Default: output_v1.csv')

parser.add_argument('--sensorIdHash', type=str, default='Garage/sensorIdHash.txt',
                    help='input data file as produced bySensorDataReformat_v1. Default: Garage/sensorIdHash.txt')

parser.add_argument('--outdb', type=str, default='SenorReadings.sqlite.db',
                    help='input data file as produced bySensorDataReformat_v1. Default: SenorReadings.sqlite.db')

args = parser.parse_args()

inpath=args.infile
#print(inpath)

if not os.path.isfile(inpath): 
   print('file   ' + args.infile +' does not exist.')
   exit()

dbpath = args.outdb
#print(dbpath)

if os.path.isfile(dbpath): 
   print('file   ' + args.outdb +' exists. Delete it first.')
   print('Error exit.')
   exit()

###################################################################
#con = sqlite3.connect("zzzSenorReadings.sqlite.db")
con = sqlite3.connect(dbpath)

#create and populate ModuleId  table
con.execute("""
  CREATE TABLE IF NOT EXISTS SensorLocation (
    modID TEXT PRIMARY KEY, 
    description TEXT NOT NULL 
  );""")

#populate sensorLocation  table
#with open('output_v1.csv', 'r') as f:
with open(inpath, 'r') as f:
   for ln in f:
      fd = ln.split(',')  
      s = '("' + fd[0] + '", ' + fd[1] + ', "' + fd[2].lstrip() + '" )' # rm leading blank fd[2]
      q = 'INSERT INTO SensorData (id, temp, timeStamp) VALUES ' + s 
      z = con.execute(q) #z= mutes printing returned obj.


con.commit()
con.close()
